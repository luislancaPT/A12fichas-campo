<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fichas">
    <meta name="theme-color" content="#1a5276">
    <title>Fichas de Campo</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        :root{--p:#1a5276;--s:#27ae60;--d:#e74c3c;--w:#f39c12;--bg:#f5f5f5;--card:#fff;--brd:#ddd}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none}
        html,body{height:100%;overflow-x:hidden}
        body{font-family:-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:#333;line-height:1.5;font-size:16px}
        
        .hdr{background:linear-gradient(135deg,#1a5276,#2c3e50);color:#fff;padding:12px 15px;position:fixed;top:0;left:0;right:0;z-index:100}
        .hdr-row{display:flex;justify-content:space-between;align-items:center}
        .hdr h1{font-size:1.1rem}
        .badge{background:#16a085;padding:4px 10px;border-radius:15px;font-size:0.7rem;font-weight:600}
        
        .nav{background:#fff;padding:8px;overflow-x:auto;white-space:nowrap;border-bottom:1px solid var(--brd);position:fixed;top:48px;left:0;right:0;z-index:90;-webkit-overflow-scrolling:touch}
        .nav-btn{display:inline-block;padding:8px 12px;margin-right:4px;border:none;background:#eee;border-radius:5px;font-size:0.8rem;font-weight:500;color:#333;text-decoration:none}
        .nav-btn.active{background:var(--p);color:#fff}
        
        .main{padding:110px 12px 100px 12px;max-width:800px;margin:0 auto}
        
        .sec{display:none}
        .sec.active{display:block}
        
        .card{background:var(--card);border-radius:10px;padding:15px;margin-bottom:15px;box-shadow:0 2px 4px rgba(0,0,0,0.08)}
        .card h2{font-size:1rem;color:var(--p);margin-bottom:12px;padding-bottom:10px;border-bottom:2px solid #f0f0f0}
        .card h3{font-size:0.9rem;margin-bottom:8px;color:#444}
        
        .info{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:10px;margin-bottom:12px;font-size:0.8rem}
        .info b{color:#856404}
        .tip{background:#e8f4f8;border-left:4px solid #3498db;padding:10px;margin-bottom:12px;font-size:0.8rem}
        
        .fg{margin-bottom:12px}
        .fg label{display:block;font-weight:500;font-size:0.85rem;margin-bottom:5px;color:#444}
        .fg small{color:#888;font-size:0.75rem}
        
        input[type="text"],input[type="date"],input[type="time"],input[type="number"],textarea,select{
            width:100%;padding:12px;border:2px solid var(--brd);border-radius:8px;font-size:16px;font-family:inherit;background:#fff;-webkit-appearance:none;appearance:none
        }
        input:focus,textarea:focus,select:focus{outline:none;border-color:var(--p)}
        textarea{min-height:80px;resize:vertical}
        textarea.lg{min-height:120px}
        
        .ch{background:#f8f9fa;border-radius:8px;padding:12px;margin-bottom:10px;border-left:4px solid var(--p)}
        .ch.vis{border-color:#3498db}.ch.aud{border-color:#9b59b6}.ch.olf{border-color:#f1c40f}.ch.ter{border-color:#e74c3c}.ch.tac{border-color:#1abc9c}.ch.esp{border-color:#34495e}
        .ch h3{font-size:0.9rem;margin-bottom:8px}
        .ch small{color:#666;font-size:0.75rem;display:block;margin-bottom:8px}
        
        .scale{margin-bottom:15px;background:#f8f9fa;border-radius:8px;padding:12px}
        .scale-t{font-weight:600;font-size:0.9rem;margin-bottom:5px}
        .scale-l{display:flex;justify-content:space-between;font-size:0.7rem;color:#888;margin-bottom:5px}
        .scale-b{display:flex;flex-wrap:wrap;gap:4px;margin-bottom:8px}
        .sbtn{width:30px;height:30px;border:2px solid var(--brd);background:#fff;border-radius:5px;font-weight:600;font-size:0.8rem}
        .sbtn.sel{background:var(--p);color:#fff;border-color:var(--p)}
        
        .rg{display:flex;flex-direction:column;gap:8px}
        .ri{display:flex;align-items:flex-start;gap:10px;padding:12px;background:#f8f9fa;border-radius:8px;border:2px solid transparent}
        .ri.sel{border-color:var(--p);background:#e8f4f8}
        .ri input[type="radio"]{width:20px;height:20px;margin-top:2px}
        .ri-l{flex:1}
        .ri-l b{display:block;font-size:0.9rem}
        .ri-l span{font-size:0.75rem;color:#666}
        
        .qg{display:grid;grid-template-columns:1fr 1fr;gap:2px;background:#ddd;border-radius:10px;overflow:hidden;margin:10px 0}
        .qd{padding:15px 10px;text-align:center}
        .qd.sel{box-shadow:inset 0 0 0 3px var(--p)}
        .q1{background:#ffebee}.q2{background:#e8f5e9}.q3{background:#e3f2fd}.q4{background:#fffde7}
        .qd b{display:block;font-size:0.8rem}
        .qd span{font-size:0.7rem;color:#666}
        
        .int{background:linear-gradient(135deg,#f8f9fa,#fff);border:2px solid var(--p);border-radius:10px;padding:15px;margin-bottom:15px}
        .int h3{display:flex;align-items:center;gap:10px;margin-bottom:12px;color:var(--p)}
        .int-n{width:28px;height:28px;background:var(--p);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:700}
        .chn{display:flex;align-items:center;gap:8px;margin-bottom:8px}
        .chn-a{background:var(--s);color:#fff;padding:4px 8px;border-radius:4px;font-size:0.7rem;font-weight:600}
        .chn input{flex:1;padding:10px;font-size:14px}
        
        .exp{background:#e8f4f8;border:2px solid var(--p);border-radius:10px;padding:15px;margin-bottom:15px}
        .exp h3{color:var(--p);margin-bottom:10px}
        .exp-b{display:flex;flex-wrap:wrap;gap:8px}
        .exp-btn{padding:10px 15px;background:#fff;border:2px solid var(--p);border-radius:8px;color:var(--p);font-weight:600;font-size:0.85rem}
        .cpy{margin-top:12px;display:none}
        .cpy.show{display:block}
        .cpy textarea{font-family:monospace;font-size:0.7rem;height:100px}
        
        .navb{display:flex;gap:10px;justify-content:space-between;margin-top:20px;padding-top:15px;border-top:2px solid #eee}
        .btn{display:inline-block;padding:14px 20px;border:none;border-radius:8px;font-size:1rem;font-weight:600;text-align:center;text-decoration:none;color:#fff;background:var(--p);-webkit-appearance:none;touch-action:manipulation}
        .btn:active{opacity:0.8}
        .btn-sec{background:#eee;color:#333}
        .btn-ok{background:var(--s)}
        
        .sbar{position:fixed;bottom:0;left:0;right:0;background:#2c3e50;color:#fff;padding:10px 15px;display:flex;justify-content:space-between;align-items:center;font-size:0.75rem;z-index:100}
        
        .toast{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);background:#333;color:#fff;padding:12px 24px;border-radius:8px;z-index:1000;display:none}
        .toast.show{display:block}
        
        .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:200;display:none;align-items:center;justify-content:center;padding:15px}
        .modal.show{display:flex}
        .modal-c{background:#fff;border-radius:12px;width:100%;max-width:500px;max-height:85vh;overflow:hidden}
        .modal-h{padding:15px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
        .modal-h h2{font-size:1.1rem}
        .modal-x{background:none;border:none;font-size:1.5rem;color:#888;padding:5px}
        .modal-b{padding:15px;max-height:65vh;overflow-y:auto}
        .modal-f{padding:12px 15px;border-top:1px solid #eee;display:flex;gap:10px;justify-content:flex-end}
        
        .fi{display:flex;align-items:center;gap:10px;padding:12px;background:#f8f9fa;border-radius:8px;margin-bottom:8px;border-left:4px solid var(--w)}
        .fi.act{background:#e8f4f8;border-left-color:var(--p)}
        .fi-i{flex:1}
        .fi-t{font-weight:600;font-size:0.85rem}
        .fi-m{font-size:0.7rem;color:#888}
        .fi-d{width:30px;height:30px;background:var(--d);color:#fff;border:none;border-radius:6px}
    </style>
</head>
<body>

<div class="hdr">
    <div class="hdr-row">
        <h1>ğŸ“‹ Fichas de Campo</h1>
        <span class="badge" id="formBadge">Nova</span>
    </div>
</div>

<div class="nav" id="nav">
    <a href="#" class="nav-btn active" data-sec="0">InÃ­cio</a>
    <a href="#" class="nav-btn" data-sec="1">1.Esp</a>
    <a href="#" class="nav-btn" data-sec="2">2.Amb</a>
    <a href="#" class="nav-btn" data-sec="3">3.SeÃ±al</a>
    <a href="#" class="nav-btn" data-sec="4">4.Aten</a>
    <a href="#" class="nav-btn" data-sec="5">5.Perc</a>
    <a href="#" class="nav-btn" data-sec="6">6.Guion</a>
    <a href="#" class="nav-btn" data-sec="7">7.Emo</a>
    <a href="#" class="nav-btn" data-sec="8">8.Integ</a>
    <a href="#" class="nav-btn" data-sec="9">9.Interv</a>
    <a href="#" class="nav-btn" data-sec="10">ğŸ’¾</a>
</div>

<div class="main">

<!-- SEC 0 -->
<div class="sec active" id="sec0">
    <div class="card">
        <h2>ğŸ“ IdentificaciÃ³n</h2>
        <div class="fg"><label>Nombre *</label><input type="text" id="nombre"></div>
        <div class="fg"><label>Fecha *</label><input type="date" id="fecha"></div>
        <div class="fg"><label>Hora inicio</label><input type="time" id="horaInicio"></div>
        <div class="fg"><label>Hora fin</label><input type="time" id="horaFin"></div>
    </div>
    <div class="card">
        <h2>ğŸ“ Fichas</h2>
        <a href="#" class="btn" style="width:100%;margin-bottom:10px;display:block;text-align:center" id="btnNova">â• Nova Ficha</a>
        <a href="#" class="btn btn-sec" style="width:100%;display:block;text-align:center" id="btnVerFichas">ğŸ“ Ver Fichas</a>
    </div>
    <div class="navb">
        <div></div>
        <a href="#" class="btn" data-next="1">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 1 -->
<div class="sec" id="sec1">
    <div class="info"><b>ğŸ“‹ CRITERIO 1:</b> Espacio contextualizado, actividad definida, documentaciÃ³n completa</div>
    <div class="card">
        <h2>ğŸ¢ Espacio</h2>
        <div class="fg"><label>Nombre del espacio *</label><small>Tipo + Nombre especÃ­fico</small><input type="text" id="nombreEspacio" placeholder="Ej: Sala espera Hospital X"></div>
        <div class="fg"><label>UbicaciÃ³n *</label><input type="text" id="ubicacion"></div>
        <div class="fg"><label>Contexto *</label><small>Â¿Por quÃ© es relevante? Â¿QuÃ© situaciÃ³n se analiza?</small><textarea id="contextoEspacio" class="lg"></textarea></div>
        <div class="fg"><label>Condiciones</label>
            <select id="meteo"><option value="">Seleccione...</option><option value="soleado">â˜€ï¸ Soleado</option><option value="nublado">â˜ï¸ Nublado</option><option value="interior">ğŸ  Interior</option></select>
        </div>
    </div>
    <div class="card">
        <h2>ğŸ¯ Actividad Objetivo *</h2>
        <div class="tip"><b>ğŸ’¡</b> Elija UNA. Todo el anÃ¡lisis se hace desde esta perspectiva.</div>
        <div class="rg" id="actividadGroup">
            <label class="ri" data-act="wayfinding"><input type="radio" name="actividad" value="wayfinding"><div class="ri-l"><b>ğŸ§­ Orientarse</b><span>Encontrar destino, saber dÃ³nde ir</span></div></label>
            <label class="ri" data-act="esperar"><input type="radio" name="actividad" value="esperar"><div class="ri-l"><b>â³ Esperar sin estrÃ©s</b><span>Aguardar sin ansiedad</span></div></label>
            <label class="ri" data-act="concentrarse"><input type="radio" name="actividad" value="concentrarse"><div class="ri-l"><b>ğŸ“š Concentrarse</b><span>Trabajar, estudiar</span></div></label>
            <label class="ri" data-act="recuperarse"><input type="radio" name="actividad" value="recuperarse"><div class="ri-l"><b>ğŸ§˜ Recuperarse</b><span>Descansar, relajarse</span></div></label>
            <label class="ri" data-act="socializar"><input type="radio" name="actividad" value="socializar"><div class="ri-l"><b>ğŸ‘¥ Socializar</b><span>Interactuar</span></div></label>
        </div>
        <div class="fg" style="margin-top:10px"><label>JustificaciÃ³n de la actividad *</label><textarea id="actividadJustificacion"></textarea></div>
    </div>
    <div class="card">
        <h2>ğŸ“ Mediciones</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
            <div class="fg"><label>ğŸ’¡ Lux</label><input type="number" id="lux"></div>
            <div class="fg"><label>ğŸ”Š dB</label><input type="number" id="db"></div>
            <div class="fg"><label>ğŸŒ¡ï¸ Â°C</label><input type="number" id="temp"></div>
        </div>
        <div class="fg"><label>DescripciÃ³n cualitativa</label><textarea id="descripcionAmbiente"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="0">â† Anterior</a>
        <a href="#" class="btn" data-next="2">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 2 -->
<div class="sec" id="sec2">
    <div class="info"><b>ğŸ“‹ CRITERIO 2:</b> AnÃ¡lisis sistemÃ¡tico por canal, seÃ±al/ruido, interferencias</div>
    <div class="card">
        <h2>ğŸŒ EstimulaciÃ³n por Canal</h2>
        <div class="ch vis"><h3>ğŸ‘ï¸ VISUAL</h3><small>Luz, colores, carteles, pantallas...</small><textarea id="estVisual" class="lg"></textarea></div>
        <div class="ch aud"><h3>ğŸ‘‚ AUDITIVO</h3><small>Ruido, mÃºsica, conversaciones...</small><textarea id="estAuditivo" class="lg"></textarea></div>
        <div class="ch olf"><h3>ğŸ‘ƒ OLFATIVO</h3><small>Olores naturales, artificiales...</small><textarea id="estOlfativo"></textarea></div>
        <div class="ch ter"><h3>ğŸŒ¡ï¸ TÃ‰RMICO</h3><small>Temperatura, corrientes...</small><textarea id="estTermico"></textarea></div>
        <div class="ch tac"><h3>âœ‹ TÃCTIL</h3><small>Texturas, materiales...</small><textarea id="estTactil"></textarea></div>
        <div class="ch esp"><h3>ğŸ“ ESPACIAL</h3><small>DistribuciÃ³n, alturas...</small><textarea id="estEspacial"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="1">â† Anterior</a>
        <a href="#" class="btn" data-next="3">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 3 -->
<div class="sec" id="sec3">
    <div class="card">
        <h2>âš¡ SeÃ±al vs Ruido</h2>
        <div class="tip"><b>SEÃ‘AL âœ“</b> = Ayuda la actividad | <b>RUIDO âœ—</b> = Dificulta</div>
        <div class="fg"><label>EstÃ­mulo 1</label><input type="text" id="stim1" placeholder="Nombre"><textarea id="stim1Just" placeholder="Â¿SeÃ±al o ruido? Â¿Por quÃ©?"></textarea></div>
        <div class="fg"><label>EstÃ­mulo 2</label><input type="text" id="stim2"><textarea id="stim2Just" placeholder="Â¿SeÃ±al o ruido? Â¿Por quÃ©?"></textarea></div>
        <div class="fg"><label>EstÃ­mulo 3</label><input type="text" id="stim3"><textarea id="stim3Just" placeholder="Â¿SeÃ±al o ruido? Â¿Por quÃ©?"></textarea></div>
        <div class="fg"><label>EstÃ­mulo 4</label><input type="text" id="stim4"><textarea id="stim4Just" placeholder="Â¿SeÃ±al o ruido? Â¿Por quÃ©?"></textarea></div>
    </div>
    <div class="card">
        <h2>âš ï¸ Conflictos Sensoriales</h2>
        <div class="fg"><label>Â¿Hay incongruencias entre canales? *</label><textarea id="conflictosSensoriales" class="lg" placeholder="Ej: Visual calmado pero auditivo caÃ³tico..."></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="2">â† Anterior</a>
        <a href="#" class="btn" data-next="4">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 4 -->
<div class="sec" id="sec4">
    <div class="info"><b>ğŸ“‹ CRITERIO 3:</b> Puntuaciones fundamentadas, relacionadas con entorno y tarea</div>
    <div class="card">
        <h2>ğŸ§  AtenciÃ³n</h2>
        <div class="scale"><div class="scale-t">ğŸ¯ SELECTIVA</div><div class="scale-l"><span>0=Sin distractores</span><span>10=Distractores</span></div><div class="scale-b" id="sc_atSelectiva"></div><textarea id="atSelectivaJust" placeholder="JUSTIFICACIÃ“N: Â¿QuÃ© distractores hay?"></textarea></div>
        <div class="scale"><div class="scale-t">â±ï¸ SOSTENIDA</div><div class="scale-l"><span>0=Mantiene foco</span><span>10=Fatiga rÃ¡pida</span></div><div class="scale-b" id="sc_atSostenida"></div><textarea id="atSostenidaJust" placeholder="JUSTIFICACIÃ“N"></textarea></div>
        <div class="scale"><div class="scale-t">ğŸ§­ ORIENTACIÃ“N</div><div class="scale-l"><span>0=Confuso</span><span>10=GuÃ­a clara</span></div><div class="scale-b" id="sc_atOrientacion"></div><textarea id="atOrientacionJust" placeholder="JUSTIFICACIÃ“N"></textarea></div>
        <div class="scale"><div class="scale-t">ğŸ›ï¸ EJECUTIVO</div><div class="scale-l"><span>0=Sin conflicto</span><span>10=Exige inhibir</span></div><div class="scale-b" id="sc_atEjecutivo"></div><textarea id="atEjecutivoJust" placeholder="JUSTIFICACIÃ“N"></textarea></div>
        <div class="scale"><div class="scale-t">ğŸ”€ DIVIDIDA</div><div class="scale-l"><span>0=Multitarea OK</span><span>10=Imposible</span></div><div class="scale-b" id="sc_atDividida"></div><textarea id="atDivididaJust" placeholder="JUSTIFICACIÃ“N"></textarea></div>
        <div class="fg"><label>SÃ­ntesis atencional *</label><textarea id="sintesisAtencion" class="lg" placeholder="En general, este espacio..."></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="3">â† Anterior</a>
        <a href="#" class="btn" data-next="5">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 5 -->
<div class="sec" id="sec5">
    <div class="info"><b>ğŸ“‹ CRITERIO 4:</b> Vincula percepciÃ³n + guion + emociÃ³n + conductas</div>
    <div class="card">
        <h2>ğŸ‘ï¸ PercepciÃ³n</h2>
        <div class="scale"><div class="scale-t">ğŸ” INSEGURO â†” SEGURO</div><div class="scale-b" id="sc_percSeguro"></div><textarea id="percSeguroJust" placeholder="Â¿QuÃ© genera seguridad/inseguridad?"></textarea></div>
        <div class="scale"><div class="scale-t">ğŸŒªï¸ CAÃ“TICO â†” ORDENADO</div><div class="scale-b" id="sc_percOrdenado"></div><textarea id="percOrdenadoJust" placeholder="Â¿QuÃ© genera orden/caos?"></textarea></div>
        <div class="scale"><div class="scale-t">ğŸ˜  HOSTIL â†” ACOGEDOR</div><div class="scale-b" id="sc_percAcogedor"></div><textarea id="percAcogedorJust" placeholder="Â¿QuÃ© genera acogida/hostilidad?"></textarea></div>
        <div class="scale"><div class="scale-t">â“ CONFUSO â†” CLARO</div><div class="scale-b" id="sc_percClaro"></div><textarea id="percClaroJust" placeholder="Â¿QuÃ© genera claridad/confusiÃ³n?"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="4">â† Anterior</a>
        <a href="#" class="btn" data-next="6">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 6 -->
<div class="sec" id="sec6">
    <div class="card">
        <h2>ğŸ’¡ Guion de AcciÃ³n</h2>
        <div class="fg"><label>ğŸ›ï¸ FunciÃ³n percibida *</label><small>Â¿QuÃ© entiende el usuario que es este lugar?</small><textarea id="funcionPercibida"></textarea></div>
        <div class="fg"><label>ğŸ“œ Reglas implÃ­citas *</label><small>Â¿QuÃ© comportamientos sugiere el espacio?</small><textarea id="reglasImplicitas"></textarea></div>
        <div class="fg"><label>ğŸª‘ Affordances *</label><small>Â¿QuÃ© invita a hacer el espacio?</small><textarea id="affordances" class="lg"></textarea></div>
        <div class="fg"><label>ğŸ“ Puntos de referencia *</label><textarea id="puntosReferencia"></textarea></div>
        <div class="fg"><label>Coherencia funciÃ³n/diseÃ±o</label><textarea id="coherenciaFuncion"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="5">â† Anterior</a>
        <a href="#" class="btn" data-next="7">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 7 -->
<div class="sec" id="sec7">
    <div class="card">
        <h2>â¤ï¸ EmociÃ³n</h2>
        <div class="scale"><div class="scale-t">ğŸ’š VALENCIA</div><div class="scale-l"><span>0=Desagradable</span><span>10=Agradable</span></div><div class="scale-b" id="sc_emoValencia"></div><textarea id="emoValenciaJust" placeholder="Â¿Por quÃ©?"></textarea></div>
        <div class="scale"><div class="scale-t">âš¡ ACTIVACIÃ“N</div><div class="scale-l"><span>0=Calma</span><span>10=Nerviosismo</span></div><div class="scale-b" id="sc_emoActivacion"></div><textarea id="emoActivacionJust" placeholder="Â¿Por quÃ©?"></textarea></div>
        <div class="fg"><label>ğŸ“Š Cuadrante *</label></div>
        <div class="qg" id="quadrant">
            <div class="qd q1" data-q="alta-neg"><b>Alta+Neg</b><span>Ansiedad</span></div>
            <div class="qd q2" data-q="alta-pos"><b>Alta+Pos</b><span>Entusiasmo</span></div>
            <div class="qd q3" data-q="baja-neg"><b>Baja+Neg</b><span>ApatÃ­a</span></div>
            <div class="qd q4" data-q="baja-pos"><b>Baja+Pos</b><span>Calma</span></div>
        </div>
        <div class="fg"><label>JustificaciÃ³n cuadrante *</label><textarea id="cuadranteJust"></textarea></div>
    </div>
    <div class="card">
        <h2>ğŸ‘¤ Conductas Observables</h2>
        <div class="fg"><label>EmociÃ³n principal</label><input type="text" id="emocion1Nombre" placeholder="Ej: Ansiedad"></div>
        <div class="fg"><label>Conductas asociadas *</label><textarea id="emocion1Conductas" placeholder="Ej: Mirar reloj, inquietud..."></textarea></div>
        <div class="fg"><label>Disparadores *</label><textarea id="emocion1Disparadores" placeholder="Ej: Incertidumbre, ruido..."></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="6">â† Anterior</a>
        <a href="#" class="btn" data-next="8">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 8 -->
<div class="sec" id="sec8">
    <div class="card">
        <h2>ğŸ”— IntegraciÃ³n Cadena Funcional</h2>
        <div class="info"><b>âš ï¸ CRÃTICO:</b> Conecte percepciÃ³n â†’ guion â†’ emociÃ³n â†’ conducta</div>
        <div class="fg"><label>1. ESTÃMULO â†’ PERCEPCIÃ“N *</label><textarea id="integracion1" class="lg" placeholder="Â¿CÃ³mo los estÃ­mulos generan la percepciÃ³n?"></textarea></div>
        <div class="fg"><label>2. PERCEPCIÃ“N â†’ GUION *</label><textarea id="integracion2" class="lg" placeholder="Â¿CÃ³mo la percepciÃ³n determina comportamientos?"></textarea></div>
        <div class="fg"><label>3. GUION â†’ EMOCIÃ“N *</label><textarea id="integracion3" class="lg" placeholder="Â¿CÃ³mo el guion genera la emociÃ³n?"></textarea></div>
        <div class="fg"><label>4. EMOCIÃ“N â†’ CONDUCTA *</label><textarea id="integracion4" class="lg" placeholder="Â¿QuÃ© conductas evidencian la emociÃ³n?"></textarea></div>
        <div class="fg"><label>SÃ­ntesis: Â¿Cumple su funciÃ³n? *</label><textarea id="sintesisFinal" class="lg"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="7">â† Anterior</a>
        <a href="#" class="btn" data-next="9">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 9 -->
<div class="sec" id="sec9">
    <div class="info"><b>ğŸ“‹ CRITERIO 5:</b> Propuestas realistas, coherentes con cadena, reflexiÃ³n crÃ­tica</div>
    <div class="int">
        <h3><span class="int-n">1</span> MicrointervenciÃ³n 1</h3>
        <div class="fg"><label>Nombre *</label><input type="text" id="int1Nombre"></div>
        <div class="fg"><label>DescripciÃ³n detallada *</label><textarea id="int1Descripcion" class="lg" placeholder="QuÃ© cambiar, coste, ubicaciÃ³n..."></textarea></div>
        <div class="fg"><label>JustificaciÃ³n *</label><textarea id="int1Justificacion"></textarea></div>
        <p style="font-weight:600;margin:10px 0">Efecto en cadena:</p>
        <div class="chn"><span class="chn-a">1</span><input type="text" id="int1E1" placeholder="EstÃ­mulo"></div>
        <div class="chn"><span class="chn-a">2</span><input type="text" id="int1E2" placeholder="PercepciÃ³n"></div>
        <div class="chn"><span class="chn-a">3</span><input type="text" id="int1E3" placeholder="Guion"></div>
        <div class="chn"><span class="chn-a">4</span><input type="text" id="int1E4" placeholder="EmociÃ³n"></div>
        <div class="chn"><span class="chn-a">5</span><input type="text" id="int1E5" placeholder="Conducta"></div>
    </div>
    <div class="int">
        <h3><span class="int-n">2</span> MicrointervenciÃ³n 2</h3>
        <div class="fg"><label>Nombre *</label><input type="text" id="int2Nombre"></div>
        <div class="fg"><label>DescripciÃ³n *</label><textarea id="int2Descripcion" class="lg"></textarea></div>
        <div class="fg"><label>JustificaciÃ³n *</label><textarea id="int2Justificacion"></textarea></div>
        <p style="font-weight:600;margin:10px 0">Efecto en cadena:</p>
        <div class="chn"><span class="chn-a">1</span><input type="text" id="int2E1" placeholder="EstÃ­mulo"></div>
        <div class="chn"><span class="chn-a">2</span><input type="text" id="int2E2" placeholder="PercepciÃ³n"></div>
        <div class="chn"><span class="chn-a">3</span><input type="text" id="int2E3" placeholder="Guion"></div>
        <div class="chn"><span class="chn-a">4</span><input type="text" id="int2E4" placeholder="EmociÃ³n"></div>
        <div class="chn"><span class="chn-a">5</span><input type="text" id="int2E5" placeholder="Conducta"></div>
    </div>
    <div class="card">
        <h2>ğŸ¯ ReflexiÃ³n Final</h2>
        <div class="fg"><label>Limitaciones del anÃ¡lisis *</label><textarea id="reflexionLimitaciones"></textarea></div>
        <div class="fg"><label>Aprendizajes *</label><textarea id="reflexionAprendizajes" class="lg"></textarea></div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="8">â† Anterior</a>
        <a href="#" class="btn" data-next="10">Siguiente â†’</a>
    </div>
</div>

<!-- SEC 10 -->
<div class="sec" id="sec10">
    <div class="card">
        <h2>âœ… Completado</h2>
        <div class="fg"><label>Notas adicionales</label><textarea id="notasFinales"></textarea></div>
    </div>
    <div class="exp">
        <h3>ğŸ“¤ Exportar</h3>
        <div class="exp-b">
            <a href="#" class="exp-btn" id="btnCopy">ğŸ“‹ Copiar Sheets</a>
            <a href="#" class="exp-btn" id="btnJSON">ğŸ“„ JSON</a>
        </div>
        <div class="cpy" id="copyArea"><textarea id="copyText" readonly></textarea><p style="font-size:0.75rem;color:#666;margin-top:5px">ğŸ‘† Toque â†’ Selecionar tudo â†’ Copiar</p></div>
    </div>
    <div class="exp">
        <h3>ğŸ“ GestÃ£o</h3>
        <div class="exp-b">
            <a href="#" class="exp-btn" id="btnNova2">â• Nova</a>
            <a href="#" class="exp-btn" id="btnDuplicar">ğŸ“‹ Duplicar</a>
        </div>
    </div>
    <div class="navb">
        <a href="#" class="btn btn-sec" data-next="9">â† Anterior</a>
        <a href="#" class="btn btn-ok" id="btnGuardar">ğŸ’¾ Guardar</a>
    </div>
</div>

</div>

<div class="sbar">
    <span id="statusText">ğŸ’¾ Pronto</span>
    <span id="pendingCount">0 fichas</span>
</div>

<div class="toast" id="toast"></div>

<div class="modal" id="modalFichas">
    <div class="modal-c">
        <div class="modal-h"><h2>ğŸ“ Fichas</h2><button class="modal-x" id="closeModal">Ã—</button></div>
        <div class="modal-b" id="listaFichas"></div>
        <div class="modal-f"><a href="#" class="btn btn-sec" id="closeModal2">Fechar</a></div>
    </div>
</div>

<script>
(function(){
    var APP = {
        formId: null,
        forms: {},
        scales: {},
        quadrant: null
    };
    
    var FIELDS = ['nombre','fecha','horaInicio','horaFin','nombreEspacio','ubicacion','contextoEspacio','meteo','actividadJustificacion','lux','db','temp','descripcionAmbiente','estVisual','estAuditivo','estOlfativo','estTermico','estTactil','estEspacial','stim1','stim1Just','stim2','stim2Just','stim3','stim3Just','stim4','stim4Just','conflictosSensoriales','atSelectivaJust','atSostenidaJust','atOrientacionJust','atEjecutivoJust','atDivididaJust','sintesisAtencion','percSeguroJust','percOrdenadoJust','percAcogedorJust','percClaroJust','funcionPercibida','reglasImplicitas','affordances','puntosReferencia','coherenciaFuncion','emoValenciaJust','emoActivacionJust','cuadranteJust','emocion1Nombre','emocion1Conductas','emocion1Disparadores','integracion1','integracion2','integracion3','integracion4','sintesisFinal','int1Nombre','int1Descripcion','int1Justificacion','int1E1','int1E2','int1E3','int1E4','int1E5','int2Nombre','int2Descripcion','int2Justificacion','int2E1','int2E2','int2E3','int2E4','int2E5','reflexionLimitaciones','reflexionAprendizajes','notasFinales'];
    
    var SCALES_CFG = [
        {id:'atSelectiva',min:0},{id:'atSostenida',min:0},{id:'atOrientacion',min:0},{id:'atEjecutivo',min:0},{id:'atDividida',min:0},
        {id:'percSeguro',min:1},{id:'percOrdenado',min:1},{id:'percAcogedor',min:1},{id:'percClaro',min:1},
        {id:'emoValencia',min:0},{id:'emoActivacion',min:0}
    ];
    
    // === INIT ===
    function init(){
        loadForms();
        buildScales();
        bindEvents();
        
        var last = localStorage.getItem('lastFormId');
        if(last && APP.forms[last]){
            loadForm(last);
        } else if(Object.keys(APP.forms).length > 0){
            loadForm(Object.keys(APP.forms)[0]);
        } else {
            newForm();
        }
        
        document.getElementById('fecha').value = new Date().toISOString().split('T')[0];
    }
    
    function buildScales(){
        SCALES_CFG.forEach(function(cfg){
            var el = document.getElementById('sc_'+cfg.id);
            if(!el) return;
            el.innerHTML = '';
            for(var i=cfg.min; i<=10; i++){
                var b = document.createElement('button');
                b.type = 'button';
                b.className = 'sbtn';
                b.textContent = i;
                b.setAttribute('data-scale', cfg.id);
                b.setAttribute('data-val', i);
                el.appendChild(b);
            }
        });
    }
    
    function bindEvents(){
        // Navigation buttons
        document.querySelectorAll('[data-next]').forEach(function(btn){
            btn.addEventListener('click', function(e){
                e.preventDefault();
                var n = parseInt(this.getAttribute('data-next'));
                goTo(n);
            });
            btn.addEventListener('touchend', function(e){
                e.preventDefault();
                var n = parseInt(this.getAttribute('data-next'));
                goTo(n);
            });
        });
        
        // Nav tabs
        document.querySelectorAll('.nav-btn').forEach(function(btn){
            btn.addEventListener('click', function(e){
                e.preventDefault();
                var n = parseInt(this.getAttribute('data-sec'));
                goTo(n);
            });
        });
        
        // Scales
        document.querySelectorAll('.scale-b').forEach(function(container){
            container.addEventListener('click', function(e){
                var btn = e.target;
                if(btn.classList.contains('sbtn')){
                    var scaleId = btn.getAttribute('data-scale');
                    var val = parseInt(btn.getAttribute('data-val'));
                    selectScale(scaleId, val);
                }
            });
        });
        
        // Quadrant
        document.getElementById('quadrant').addEventListener('click', function(e){
            var qd = e.target.closest('.qd');
            if(qd){
                var q = qd.getAttribute('data-q');
                selectQuadrant(q);
            }
        });
        
        // Radio items
        document.querySelectorAll('.ri').forEach(function(ri){
            ri.addEventListener('click', function(){
                document.querySelectorAll('.ri').forEach(function(r){ r.classList.remove('sel'); });
                this.classList.add('sel');
                this.querySelector('input').checked = true;
                save();
            });
        });
        
        // Buttons
        document.getElementById('btnNova').addEventListener('click', function(e){ e.preventDefault(); newForm(); });
        document.getElementById('btnNova2').addEventListener('click', function(e){ e.preventDefault(); newForm(); });
        document.getElementById('btnVerFichas').addEventListener('click', function(e){ e.preventDefault(); showFichasModal(); });
        document.getElementById('btnGuardar').addEventListener('click', function(e){ e.preventDefault(); save(); toast('Guardado!'); });
        document.getElementById('btnCopy').addEventListener('click', function(e){ e.preventDefault(); copyForSheets(); });
        document.getElementById('btnJSON').addEventListener('click', function(e){ e.preventDefault(); exportJSON(); });
        document.getElementById('btnDuplicar').addEventListener('click', function(e){ e.preventDefault(); duplicateForm(); });
        document.getElementById('closeModal').addEventListener('click', function(e){ e.preventDefault(); hideModal(); });
        document.getElementById('closeModal2').addEventListener('click', function(e){ e.preventDefault(); hideModal(); });
        
        // Auto-save on input
        FIELDS.forEach(function(f){
            var el = document.getElementById(f);
            if(el){
                el.addEventListener('change', save);
                el.addEventListener('blur', save);
            }
        });
    }
    
    // === NAVIGATION ===
    function goTo(n){
        save();
        document.querySelectorAll('.sec').forEach(function(s){ s.classList.remove('active'); });
        document.querySelectorAll('.nav-btn').forEach(function(b){ b.classList.remove('active'); });
        document.getElementById('sec'+n).classList.add('active');
        document.querySelectorAll('.nav-btn')[n].classList.add('active');
        window.scrollTo(0,0);
    }
    
    // === FORMS ===
    function loadForms(){
        try{ APP.forms = JSON.parse(localStorage.getItem('neuroForms')||'{}'); }
        catch(e){ APP.forms = {}; }
    }
    
    function saveForms(){
        localStorage.setItem('neuroForms', JSON.stringify(APP.forms));
        updateStatus();
    }
    
    function newForm(){
        var id = 'f' + Date.now();
        APP.forms[id] = {id:id, created:new Date().toISOString(), data:{}, scales:{}, quadrant:null};
        saveForms();
        loadForm(id);
        toast('Nova ficha!');
    }
    
    function loadForm(id){
        if(!APP.forms[id]) return;
        APP.formId = id;
        localStorage.setItem('lastFormId', id);
        var form = APP.forms[id];
        
        APP.scales = form.scales || {};
        APP.quadrant = form.quadrant;
        
        // Clear all
        FIELDS.forEach(function(f){
            var el = document.getElementById(f);
            if(el) el.value = '';
        });
        document.querySelectorAll('.sbtn').forEach(function(b){ b.classList.remove('sel'); });
        document.querySelectorAll('.qd').forEach(function(q){ q.classList.remove('sel'); });
        document.querySelectorAll('.ri').forEach(function(r){ r.classList.remove('sel'); r.querySelector('input').checked = false; });
        
        // Load data
        if(form.data){
            FIELDS.forEach(function(f){
                var el = document.getElementById(f);
                if(el && form.data[f]) el.value = form.data[f];
            });
            if(form.data.actividad){
                var ri = document.querySelector('.ri[data-act="'+form.data.actividad+'"]');
                if(ri){ ri.classList.add('sel'); ri.querySelector('input').checked = true; }
            }
        }
        
        // Load scales
        Object.keys(APP.scales).forEach(function(s){
            var container = document.getElementById('sc_'+s);
            if(container){
                var btn = container.querySelector('[data-val="'+APP.scales[s]+'"]');
                if(btn) btn.classList.add('sel');
            }
        });
        
        // Load quadrant
        if(APP.quadrant){
            var qd = document.querySelector('.qd[data-q="'+APP.quadrant+'"]');
            if(qd) qd.classList.add('sel');
        }
        
        updateBadge();
    }
    
    function save(){
        if(!APP.formId) return;
        var form = APP.forms[APP.formId];
        if(!form) return;
        
        var data = {};
        FIELDS.forEach(function(f){
            var el = document.getElementById(f);
            if(el) data[f] = el.value;
        });
        
        var act = document.querySelector('input[name="actividad"]:checked');
        if(act) data.actividad = act.value;
        
        form.data = data;
        form.scales = APP.scales;
        form.quadrant = APP.quadrant;
        form.modified = new Date().toISOString();
        
        saveForms();
        updateBadge();
        document.getElementById('statusText').textContent = 'ğŸ’¾ Guardado';
    }
    
    function deleteForm(id){
        if(!confirm('Eliminar?')) return;
        delete APP.forms[id];
        saveForms();
        if(id === APP.formId){
            var keys = Object.keys(APP.forms);
            if(keys.length > 0) loadForm(keys[0]);
            else newForm();
        }
        showFichasModal();
    }
    
    function duplicateForm(){
        save();
        var curr = APP.forms[APP.formId];
        if(!curr) return;
        var id = 'f' + Date.now();
        var nf = JSON.parse(JSON.stringify(curr));
        nf.id = id;
        nf.created = new Date().toISOString();
        APP.forms[id] = nf;
        saveForms();
        loadForm(id);
        toast('Duplicada!');
    }
    
    function updateBadge(){
        var form = APP.forms[APP.formId];
        var name = 'Nova';
        if(form && form.data){
            if(form.data.nombreEspacio) name = form.data.nombreEspacio;
            else if(form.data.nombre) name = form.data.nombre;
        }
        document.getElementById('formBadge').textContent = name.substring(0,12);
    }
    
    function updateStatus(){
        document.getElementById('pendingCount').textContent = Object.keys(APP.forms).length + ' fichas';
    }
    
    // === SCALES ===
    function selectScale(scaleId, val){
        APP.scales[scaleId] = val;
        var container = document.getElementById('sc_'+scaleId);
        if(container){
            container.querySelectorAll('.sbtn').forEach(function(b){ b.classList.remove('sel'); });
            var btn = container.querySelector('[data-val="'+val+'"]');
            if(btn) btn.classList.add('sel');
        }
        save();
    }
    
    function selectQuadrant(q){
        APP.quadrant = q;
        document.querySelectorAll('.qd').forEach(function(el){ el.classList.remove('sel'); });
        var qd = document.querySelector('.qd[data-q="'+q+'"]');
        if(qd) qd.classList.add('sel');
        save();
    }
    
    // === MODAL ===
    function showFichasModal(){
        var list = document.getElementById('listaFichas');
        var keys = Object.keys(APP.forms).sort(function(a,b){
            return new Date(APP.forms[b].modified||APP.forms[b].created) - new Date(APP.forms[a].modified||APP.forms[a].created);
        });
        
        if(keys.length === 0){
            list.innerHTML = '<p style="text-align:center;color:#888;padding:20px">Sem fichas</p>';
        } else {
            list.innerHTML = keys.map(function(id){
                var f = APP.forms[id];
                var name = (f.data && f.data.nombreEspacio) || (f.data && f.data.nombre) || 'Sem nome';
                var date = new Date(f.modified||f.created).toLocaleDateString('pt-PT');
                var act = id === APP.formId ? 'act' : '';
                return '<div class="fi '+act+'" data-fid="'+id+'"><div class="fi-i"><div class="fi-t">'+name+'</div><div class="fi-m">'+date+'</div></div><button type="button" class="fi-d" data-del="'+id+'">ğŸ—‘ï¸</button></div>';
            }).join('');
        }
        
        // Bind click on items
        list.querySelectorAll('.fi').forEach(function(fi){
            fi.addEventListener('click', function(e){
                if(e.target.classList.contains('fi-d')) return;
                var fid = this.getAttribute('data-fid');
                loadForm(fid);
                hideModal();
            });
        });
        
        // Bind delete
        list.querySelectorAll('.fi-d').forEach(function(btn){
            btn.addEventListener('click', function(e){
                e.stopPropagation();
                var id = this.getAttribute('data-del');
                deleteForm(id);
            });
        });
        
        document.getElementById('modalFichas').classList.add('show');
    }
    
    function hideModal(){
        document.getElementById('modalFichas').classList.remove('show');
    }
    
    // === EXPORT ===
    function copyForSheets(){
        save();
        var f = APP.forms[APP.formId];
        var d = f.data || {};
        var s = f.scales || {};
        
        var headers = ['Fecha','Espacio','Actividad','atSelectiva','atSostenida','atOrientacion','atEjecutivo','atDividida','percSeguro','percOrdenado','percAcogedor','percClaro','emoValencia','emoActivacion','Cuadrante','Int1','Int2'];
        var values = [d.fecha||'',d.nombreEspacio||'',d.actividad||'',s.atSelectiva!==undefined?s.atSelectiva:'',s.atSostenida!==undefined?s.atSostenida:'',s.atOrientacion!==undefined?s.atOrientacion:'',s.atEjecutivo!==undefined?s.atEjecutivo:'',s.atDividida!==undefined?s.atDividida:'',s.percSeguro!==undefined?s.percSeguro:'',s.percOrdenado!==undefined?s.percOrdenado:'',s.percAcogedor!==undefined?s.percAcogedor:'',s.percClaro!==undefined?s.percClaro:'',s.emoValencia!==undefined?s.emoValencia:'',s.emoActivacion!==undefined?s.emoActivacion:'',f.quadrant||'',d.int1Nombre||'',d.int2Nombre||''];
        
        document.getElementById('copyText').value = headers.join('\t') + '\n' + values.join('\t');
        document.getElementById('copyArea').classList.add('show');
        toast('Pronto para copiar!');
    }
    
    function exportJSON(){
        save();
        var f = APP.forms[APP.formId];
        var str = JSON.stringify(f, null, 2);
        var blob = new Blob([str], {type:'application/json'});
        var url = URL.createObjectURL(blob);
        var a = document.createElement('a');
        a.href = url;
        a.download = 'ficha_'+(f.data.nombreEspacio||f.id)+'.json';
        a.click();
        URL.revokeObjectURL(url);
        toast('Exportado!');
    }
    
    // === TOAST ===
    function toast(msg){
        var t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(function(){ t.classList.remove('show'); }, 2500);
    }
    
    // === SERVICE WORKER ===
    if('serviceWorker' in navigator){
        navigator.serviceWorker.register('sw.js').catch(function(){});
    }
    
    // === START ===
    if(document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
</script>

</body>
</html>
